<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solidity Security Analyzer Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --danger: #dc2626;
            --warning: #f59e0b;
            --success: #059669;
            --info: #0891b2;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-lg: rgba(0, 0, 0, 0.15);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, #ffffff 100%);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 60px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px var(--shadow);
        }
        
        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
        }
        
        .header p {
            font-size: 1.1rem;
            color: var(--gray-600);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        
        .input-panel, .results-panel {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px var(--shadow);
        }
        
        .panel-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .code-textarea {
            width: 100%;
            height: 400px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 20px;
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            font-size: 14px;
            line-height: 1.5;
            background: var(--gray-50);
            color: var(--gray-800);
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        .code-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .analyze-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
        }
        
        .analyze-btn:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
            transform: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--gray-50);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        .vulnerability-card {
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
            background: white;
        }
        
        .vulnerability-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }
        
        .vulnerability-header:hover {
            background: var(--gray-50);
        }
        
        .severity-critical .vulnerability-header { border-right: 4px solid var(--danger); }
        .severity-high .vulnerability-header { border-right: 4px solid #ea580c; }
        .severity-medium .vulnerability-header { border-right: 4px solid var(--warning); }
        .severity-low .vulnerability-header { border-right: 4px solid var(--success); }
        .severity-info .vulnerability-header { border-right: 4px solid var(--info); }
        
        .vulnerability-title {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 5px;
        }
        
        .vulnerability-meta {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        .vulnerability-details {
            padding: 0 20px 20px;
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        .vulnerability-details.active {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .code-block {
            background: var(--gray-800);
            color: #e5e7eb;
            padding: 16px;
            border-radius: 8px;
            font-family: 'SF Mono', monospace;
            font-size: 14px;
            margin: 15px 0;
            overflow-x: auto;
        }
        
        .recommendation {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            border-radius: 8px;
            padding: 16px;
            margin: 15px 0;
        }
        
        .recommendation h4 {
            color: var(--success);
            margin-bottom: 8px;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-600);
        }
        
        .no-results.success {
            color: var(--success);
        }
        
        .expand-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
            color: var(--gray-600);
        }
        
        .expand-icon.rotated {
            transform: rotate(180deg);
        }
        
        .severity-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .severity-critical { background: #fef2f2; color: var(--danger); }
        .severity-high { background: #fff7ed; color: #ea580c; }
        .severity-medium { background: #fffbeb; color: var(--warning); }
        .severity-low { background: #f0fdf4; color: var(--success); }
        .severity-info { background: #f0f9ff; color: var(--info); }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üõ°Ô∏è Solidity Security Pro</h1>
            <p>ÿ™ÿ≠ŸÑ€åŸÑ⁄Øÿ± Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá Ÿà ŸáŸàÿ¥ŸÖŸÜÿØ ÿßŸÖŸÜ€åÿ™ ŸÇÿ±ÿßÿ±ÿØÿßÿØŸáÿß€å Solidity ÿ®ÿß ŸÇÿßÿ®ŸÑ€åÿ™‚ÄåŸáÿß€å ÿ®ÿßŸÑÿßÿ™ÿ± ÿßÿ≤ Slither</p>
        </header>
        
        <div class="main-grid">
            <div class="input-panel">
                <h2 class="panel-title">
                    üìù ⁄©ÿØ Solidity
                </h2>
                <textarea 
                    id="solidityCode" 
                    class="code-textarea" 
                    placeholder="// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract MyContract {
    address public owner;
    mapping(address => uint256) public balances;
    
    constructor() {
        owner = msg.sender;
    }
    
    function withdraw() public {
        uint256 amount = balances[msg.sender];
        balances[msg.sender] = 0;
        payable(msg.sender).transfer(amount);
    }
}">
                </textarea>
                <button id="analyzeBtn" class="analyze-btn">
                    <span id="btnText">üîç ÿ™ÿ≠ŸÑ€åŸÑ ÿßŸÖŸÜ€åÿ™€å</span>
                </button>
            </div>
            
            <div class="results-panel">
                <h2 class="panel-title">
                    üìä ŸÜÿ™ÿß€åÿ¨ ÿ™ÿ≠ŸÑ€åŸÑ
                </h2>
                <div id="results">
                    <div class="no-results">
                        ⁄©ÿØ ÿÆŸàÿØ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ÿ±ÿØŸá Ÿà ÿØ⁄©ŸÖŸá ÿ™ÿ≠ŸÑ€åŸÑ ÿ±ÿß ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AdvancedSolidityAnalyzer {
            constructor() {
                this.patterns = this.initializePatterns();
                this.gasAnalysis = this.initializeGasPatterns();
                this.setupEventListeners();
            }

            initializePatterns() {
                return {
                    reentrancy: {
                        patterns: [
                            /\.call\s*\{[^}]*value[^}]*\}[^;]*;/g,
                            /\.transfer\s*\([^)]+\)[^;]*;\s*(?!.*balances\[[^\]]+\]\s*=\s*0)/g,
                            /payable\([^)]+\)\.call/g,
                            /(address\([^)]+\)|payable\([^)]+\))\.call\{value:/g
                        ],
                        antiPatterns: [
                            /nonReentrant/gi,
                            /ReentrancyGuard/gi,
                            /require\s*\(\s*!locked/gi,
                            /locked\s*=\s*true/g,
                            /balances\[[^\]]+\]\s*=\s*0.*\.call/gs
                        ],
                        severity: 'critical',
                        title: 'ÿ¢ÿ≥€åÿ®‚ÄåŸæÿ∞€åÿ±€å Reentrancy',
                        description: 'ÿßŸÖ⁄©ÿßŸÜ ÿ≠ŸÖŸÑŸá Reentrancy Ÿàÿ¨ŸàÿØ ÿØÿßÿ±ÿØ - ŸÖŸáÿßÿ¨ŸÖ ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ™ÿßÿ®ÿπ ÿ±ÿß ŸÇÿ®ŸÑ ÿßÿ≤ ÿßÿ™ŸÖÿßŸÖ ÿßÿ¨ÿ±ÿß ŸÖÿ¨ÿØÿØÿßŸã ŸÅÿ±ÿßÿÆŸàÿßŸÜ€å ⁄©ŸÜÿØ'
                    },

                    uncheckedTransfer: {
                        patterns: [
                            /\.transfer\s*\([^)]+\)\s*;/g,
                            /\.send\s*\([^)]+\)\s*;/g,
                            /\.call\s*\{[^}]*\}\s*\([^)]*\)\s*;/g
                        ],
                        antiPatterns: [
                            /require\s*\([^)]*\.call[^)]*\)/g,
                            /require\s*\([^)]*\.send[^)]*\)/g,
                            /if\s*\([^)]*\.call[^)]*success[^)]*\)/g,
                            /\(bool\s+success[^)]*\)\s*=.*\.call/g
                        ],
                        severity: 'high',
                        title: 'ÿßŸÜÿ™ŸÇÿßŸÑ ÿ®ÿØŸàŸÜ ÿ®ÿ±ÿ±ÿ≥€å ŸÜÿ™€åÿ¨Ÿá',
                        description: 'ÿßŸÜÿ™ŸÇÿßŸÑ ÿßÿ™ÿ± €åÿß ÿ™Ÿà⁄©ŸÜ ÿ®ÿØŸàŸÜ ÿ®ÿ±ÿ±ÿ≥€å ŸÖŸàŸÅŸÇ€åÿ™ ÿπŸÖŸÑ€åÿßÿ™ ⁄©Ÿá ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ŸÖŸÜÿ¨ÿ± ÿ®Ÿá ÿßÿ≤ ÿØÿ≥ÿ™ ÿ±ŸÅÿ™ŸÜ Ÿàÿ¨ŸàŸá ÿ¥ŸàÿØ'
                    },

                    accessControl: {
                        patterns: [
                            /function\s+\w+[^{]*public[^{]*payable[^{]*\{/g,
                            /function\s+\w+[^{]*external[^{]*payable[^{]*\{/g,
                            /selfdestruct\s*\(/g,
                            /suicide\s*\(/g
                        ],
                        antiPatterns: [
                            /onlyOwner/g,
                            /require\s*\(\s*msg\.sender\s*==\s*owner/g,
                            /modifier\s+only\w+/g,
                            /hasRole\s*\(/g,
                            /_checkOwner\s*\(/g
                        ],
                        severity: 'critical',
                        title: '⁄©ŸÜÿ™ÿ±ŸÑ ÿØÿ≥ÿ™ÿ±ÿ≥€å ŸÜÿß⁄©ÿßŸÅ€å',
                        description: 'ÿ™Ÿàÿßÿ®ÿπ ÿ≠ÿ≥ÿßÿ≥ ÿ®ÿØŸàŸÜ ⁄©ŸÜÿ™ÿ±ŸÑ ÿØÿ≥ÿ™ÿ±ÿ≥€å ŸÖŸÜÿßÿ≥ÿ® ⁄©Ÿá ÿßÿ¨ÿßÿ≤Ÿá ÿØÿ≥ÿ™ÿ±ÿ≥€å ÿ∫€åÿ±ŸÖÿ¨ÿßÿ≤ ÿ®Ÿá Ÿáÿ± ⁄©ÿßÿ±ÿ®ÿ±€å ÿ±ÿß ŸÖ€å‚ÄåÿØŸáÿØ'
                    },

                    integerOverflow: {
                        patterns: [
                            /\+\+\w+|--\w+|\w\+\+|\w--|[\w\[\]\.]+\s*[\+\-\*\/]\s*=\s*\w+/g,
                            /unchecked\s*\{[^}]*[\+\-\*\/][^}]*\}/gs
                        ],
                        antiPatterns: [
                            /pragma\s+solidity\s+[\^~>=<\s]*0\.8/g,
                            /SafeMath/g,
                            /require\s*\([^)]*overflow[^)]*\)/gi,
                            /Math\.add|Math\.sub|Math\.mul/g
                        ],
                        severity: 'medium',
                        title: 'ÿßÿ≠ÿ™ŸÖÿßŸÑ Integer Overflow/Underflow',
                        description: 'ÿπŸÖŸÑ€åÿßÿ™ ÿ±€åÿßÿ∂€å ⁄©Ÿá ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ŸÖŸÜÿ¨ÿ± ÿ®Ÿá overflow €åÿß underflow ÿ¥ŸàÿØÿå ŸÖÿÆÿµŸàÿµÿßŸã ÿØÿ± ŸÜÿ≥ÿÆŸá‚ÄåŸáÿß€å ŸÇÿØ€åŸÖ€å Solidity'
                    },

                    timestampManipulation: {
                        patterns: [
                            /block\.timestamp\s*[<>=!]+\s*\w+/g,
                            /now\s*[<>=!]+\s*\w+/g,
                            /require\s*\([^)]*block\.timestamp[^)]*\)/g,
                            /if\s*\([^)]*block\.timestamp[^)]*\)/g
                        ],
                        antiPatterns: [
                            /block\.number/g,
                            /oracle/gi,
                            /chainlink/gi
                        ],
                        severity: 'medium',
                        title: 'Ÿàÿßÿ®ÿ≥ÿ™⁄Ø€å ÿÆÿ∑ÿ±ŸÜÿß⁄© ÿ®Ÿá ÿ≤ŸÖÿßŸÜ',
                        description: 'ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ block.timestamp ⁄©Ÿá ÿ™Ÿàÿ≥ÿ∑ ŸÖÿß€åŸÜÿ±Ÿáÿß ŸÇÿßÿ®ŸÑ ÿØÿ≥ÿ™⁄©ÿßÿ±€å ÿßÿ≥ÿ™ Ÿà ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ŸÖŸÜÿ¨ÿ± ÿ®Ÿá ŸÜÿ™ÿß€åÿ¨ ÿ∫€åÿ±ŸÇÿßÿ®ŸÑ Ÿæ€åÿ¥‚Äåÿ®€åŸÜ€å ÿ¥ŸàÿØ'
                    },

                    txOrigin: {
                        patterns: [
                            /tx\.origin/g
                        ],
                        antiPatterns: [
                            /msg\.sender/g
                        ],
                        severity: 'high',
                        title: 'ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿÆÿ∑ÿ±ŸÜÿß⁄© ÿßÿ≤ tx.origin',
                        description: 'tx.origin ÿ®Ÿá ÿ¨ÿß€å msg.sender ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿ¥ÿØŸá ⁄©Ÿá ŸÖŸÜÿ¨ÿ± ÿ®Ÿá ÿ¢ÿ≥€åÿ®‚ÄåŸæÿ∞€åÿ±€å phishing ŸÖ€å‚Äåÿ¥ŸàÿØ'
                    },

                    weakRandomness: {
                        patterns: [
                            /keccak256\s*\([^)]*block\.(timestamp|number|difficulty)[^)]*\)/g,
                            /blockhash\s*\([^)]*\)\s*%/g,
                            /block\.difficulty\s*%/g
                        ],
                        antiPatterns: [
                            /VRF/gi,
                            /oracle/gi,
                            /chainlink/gi,
                            /commit.*reveal/gi
                        ],
                        severity: 'high',
                        title: 'ÿ™ŸàŸÑ€åÿØ ÿπÿØÿØ ÿ™ÿµÿßÿØŸÅ€å ÿ∂ÿπ€åŸÅ',
                        description: 'ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ŸÖŸÜÿßÿ®ÿπ ŸÇÿßÿ®ŸÑ Ÿæ€åÿ¥‚Äåÿ®€åŸÜ€å ÿ®ÿ±ÿß€å ÿ™ŸàŸÑ€åÿØ ÿπÿØÿØ ÿ™ÿµÿßÿØŸÅ€å ⁄©Ÿá ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ÿ™Ÿàÿ≥ÿ∑ ŸÖŸáÿßÿ¨ŸÖÿßŸÜ Ÿæ€åÿ¥‚Äåÿ®€åŸÜ€å ÿ¥ŸàÿØ'
                    },

                    delegateCall: {
                        patterns: [
                            /\.delegatecall\s*\(/g,
                            /assembly\s*\{[^}]*delegatecall[^}]*\}/gs
                        ],
                        antiPatterns: [
                            /require\s*\([^)]*success[^)]*\)/g,
                            /onlyOwner/g
                        ],
                        severity: 'critical',
                        title: 'ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿÆÿ∑ÿ±ŸÜÿß⁄© ÿßÿ≤ delegatecall',
                        description: 'delegatecall ÿ®ÿØŸàŸÜ ⁄©ŸÜÿ™ÿ±ŸÑ ŸÖŸÜÿßÿ≥ÿ® ⁄©Ÿá ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ŸÖŸÜÿ¨ÿ± ÿ®Ÿá ÿßÿ¨ÿ±ÿß€å ⁄©ÿØ ŸÖÿÆÿ±ÿ® ÿØÿ± context ŸÇÿ±ÿßÿ±ÿØÿßÿØ ÿ¥ŸàÿØ'
                    },

                    gasLimit: {
                        patterns: [
                            /for\s*\([^{]*\.length[^{]*\)\s*\{[^}]*\}/gs,
                            /while\s*\([^{]*\.length[^{]*\)\s*\{[^}]*\}/gs,
                            /\.push\s*\([^)]*\)[^;]*;[^}]*\.length/gs
                        ],
                        antiPatterns: [
                            /require\s*\([^)]*\.length\s*[<>][^)]*\)/g,
                            /break\s*;/g,
                            /if\s*\([^)]*gas[^)]*\)\s*break/gi
                        ],
                        severity: 'medium',
                        title: 'ÿ≠ŸÖŸÑŸá DoS ÿ®ÿß ŸÖÿ≠ÿØŸàÿØ€åÿ™ ⁄Øÿßÿ≤',
                        description: 'ÿ≠ŸÑŸÇŸá‚ÄåŸáÿß€å ŸÜÿßŸÖÿ≠ÿØŸàÿØ ÿ±Ÿà€å ÿ¢ÿ±ÿß€åŸá‚ÄåŸáÿß ⁄©Ÿá ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ŸÖŸÜÿ¨ÿ± ÿ®Ÿá ÿßÿ™ŸÖÿßŸÖ ⁄Øÿßÿ≤ Ÿà ÿπÿØŸÖ ÿßÿ¨ÿ±ÿß€å ÿ™ÿ±ÿß⁄©ŸÜÿ¥ ÿ¥ŸàÿØ'
                    },

                    frontRunning: {
                        patterns: [
                            /function\s+\w+[^{]*public[^{]*\{[^}]*transfer[^}]*\}/gs,
                            /function\s+\w+[^{]*external[^{]*\{[^}]*approve[^}]*\}/gs,
                            /function\s+\w+[^{]*public[^{]*\{[^}]*balanceOf[^}]*\}/gs
                        ],
                        antiPatterns: [
                            /commit.*reveal/gi,
                            /timelock/gi,
                            /private/g
                        ],
                        severity: 'medium',
                        title: 'ÿ¢ÿ≥€åÿ®‚ÄåŸæÿ∞€åÿ±€å Front-Running',
                        description: 'ÿ™Ÿàÿßÿ®ÿπ ÿ≠ÿ≥ÿßÿ≥ ⁄©Ÿá ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ÿØÿ± ŸÖÿπÿ±ÿ∂ ÿ≠ŸÖŸÑÿßÿ™ front-running ŸÇÿ±ÿßÿ± ÿ®⁄Ø€åÿ±ŸÜÿØ'
                    }
                };
            }

            initializeGasPatterns() {
                return {
                    inefficientLoops: /for\s*\([^)]*\)\s*\{[^}]*\.push[^}]*\}/gs,
                    storageInLoop: /for\s*\([^)]*\)\s*\{[^}]*storage[^}]*\}/gs,
                    redundantChecks: /require\s*\([^)]*\);\s*require\s*\([^)]*\);/g
                };
            }

            setupEventListeners() {
                const analyzeBtn = document.getElementById('analyzeBtn');
                const codeInput = document.getElementById('solidityCode');

                analyzeBtn.addEventListener('click', () => {
                    this.performAnalysis();
                });

                // Real-time hints (debounced)
                let timeout;
                codeInput.addEventListener('input', () => {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        this.showQuickHints();
                    }, 1000);
                });
            }

            async performAnalysis() {
                const code = document.getElementById('solidityCode').value.trim();
                
                if (!code) {
                    this.showError('ŸÑÿ∑ŸÅÿßŸã ⁄©ÿØ Solidity ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ');
                    return;
                }

                this.showLoading();
                
                // Simulate processing time for better UX
                setTimeout(() => {
                    const vulnerabilities = this.analyzeCode(code);
                    this.displayResults(vulnerabilities);
                }, 1200);
            }

            analyzeCode(code) {
                const vulnerabilities = [];

                // Deep pattern analysis
                for (const [key, pattern] of Object.entries(this.patterns)) {
                    const findings = this.detectPattern(code, pattern);
                    if (findings.length > 0) {
                        vulnerabilities.push({
                            id: key,
                            ...pattern,
                            findings,
                            lineNumbers: this.getLineNumbers(code, findings),
                            confidence: this.calculateConfidence(code, pattern),
                            gasImpact: this.assessGasImpact(key)
                        });
                    }
                }

                // Advanced contextual analysis
                vulnerabilities.push(...this.performContextualAnalysis(code));

                return vulnerabilities.sort((a, b) => 
                    this.getSeverityWeight(b.severity) - this.getSeverityWeight(a.severity)
                );
            }

            detectPattern(code, pattern) {
                const findings = [];
                let hasVulnerability = false;

                // Check vulnerability patterns
                for (const regex of pattern.patterns) {
                    const matches = [...code.matchAll(regex)];
                    if (matches.length > 0) {
                        hasVulnerability = true;
                        findings.push(...matches.map(match => ({
                            code: match[0],
                            position: match.index,
                            context: this.getContext(code, match.index)
                        })));
                    }
                }

                // Check for mitigations
                let hasMitigation = false;
                for (const antiRegex of pattern.antiPatterns) {
                    if (antiRegex.test(code)) {
                        hasMitigation = true;
                        break;
                    }
                }

                return (hasVulnerability && !hasMitigation) ? findings : [];
            }

            performContextualAnalysis(code) {
                const contextualIssues = [];

                // Check for missing events in critical functions
                if (/function\s+\w+.*payable/g.test(code) && !/emit\s+/g.test(code)) {
                    contextualIssues.push({
                        id: 'missing_events',
                        severity: 'low',
                        title: 'ÿ±Ÿà€åÿØÿßÿØŸáÿß€å ŸÖŸÅŸÇŸàÿØ ÿØÿ± ÿ™Ÿàÿßÿ®ÿπ ŸÖŸáŸÖ',
                        description: 'ÿ™Ÿàÿßÿ®ÿπ Ÿæÿ±ÿØÿßÿÆÿ™ ÿ®ÿØŸàŸÜ ÿßŸÜÿ™ÿ¥ÿßÿ± ÿ±Ÿà€åÿØÿßÿØ ŸÖŸÜÿßÿ≥ÿ® ⁄©Ÿá ÿ±ÿØ€åÿßÿ®€å ÿ™ÿ±ÿß⁄©ŸÜÿ¥‚ÄåŸáÿß ÿ±ÿß ÿØÿ¥Ÿàÿßÿ± ŸÖ€å‚Äå⁄©ŸÜÿØ',
                        findings: [{code: 'Missing events in payable functions', position: 0}],
                        lineNumbers: []
                    });
                }

                // Check for hardcoded values
                const hardcodedValues = [...code.matchAll(/0x[a-fA-F0-9]{40}|\d{10,}/g)];
                if (hardcodedValues.length > 0) {
                    contextualIssues.push({
                        id: 'hardcoded_values',
                        severity: 'info',
                        title: 'ŸÖŸÇÿßÿØ€åÿ± Ÿáÿßÿ±ÿØ⁄©ÿØ ÿ¥ÿØŸá',
                        description: 'ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ŸÖŸÇÿßÿØ€åÿ± ÿ´ÿßÿ®ÿ™ ⁄©Ÿá ÿßŸÜÿπÿ∑ÿßŸÅ‚ÄåŸæÿ∞€åÿ±€å ⁄©ÿØ ÿ±ÿß ⁄©ÿßŸáÿ¥ ŸÖ€å‚ÄåÿØŸáÿØ',
                        findings: hardcodedValues.map(match => ({
                            code: match[0],
                            position: match.index
                        })),
                        lineNumbers: this.getLineNumbers(code, hardcodedValues.map(m => ({position: m.index})))
                    });
                }

                // Check for floating pragma
                if (/pragma\s+solidity\s+\^/g.test(code)) {
                    contextualIssues.push({
                        id: 'floating_pragma',
                        severity: 'info',
                        title: 'Pragma ÿ¥ŸÜÿßŸàÿ±',
                        description: 'ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ pragma ÿ¥ŸÜÿßŸàÿ± ⁄©Ÿá ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ŸÖŸÜÿ¨ÿ± ÿ®Ÿá ŸÖÿ¥⁄©ŸÑÿßÿ™ ÿ≥ÿßÿ≤⁄Øÿßÿ±€å ÿ¥ŸàÿØ',
                        findings: [{code: 'Floating pragma detected', position: 0}],
                        lineNumbers: []
                    });
                }

                return contextualIssues;
            }

            getContext(code, position) {
                const lines = code.split('\n');
                let currentPos = 0;
                
                for (let i = 0; i < lines.length; i++) {
                    if (currentPos <= position && position <= currentPos + lines[i].length) {
                        const start = Math.max(0, i - 2);
                        const end = Math.min(lines.length - 1, i + 2);
                        return lines.slice(start, end + 1).join('\n');
                    }
                    currentPos += lines[i].length + 1;
                }
                
                return '';
            }

            getLineNumbers(code, findings) {
                const lines = code.split('\n');
                const lineNumbers = [];
                
                findings.forEach(finding => {
                    let currentPos = 0;
                    for (let i = 0; i < lines.length; i++) {
                        if (currentPos <= finding.position && finding.position <= currentPos + lines[i].length) {
                            lineNumbers.push(i + 1);
                            break;
                        }
                        currentPos += lines[i].length + 1;
                    }
                });
                
                return [...new Set(lineNumbers)].sort((a, b) => a - b);
            }

            calculateConfidence(code, pattern) {
                let confidence = 70; // Base confidence
                
                // Increase confidence based on pattern strength
                if (pattern.patterns.length > 2) confidence += 10;
                if (pattern.antiPatterns.length > 0) confidence += 5;
                
                // Context-based adjustments
                if (code.includes('pragma solidity ^0.8')) confidence += 5;
                if (code.includes('ReentrancyGuard')) confidence -= 10;
                
                return Math.min(95, Math.max(60, confidence));
            }

            assessGasImpact(patternId) {
                const gasImpacts = {
                    reentrancy: 'high',
                    gasLimit: 'critical',
                    delegateCall: 'medium',
                    default: 'low'
                };
                
                return gasImpacts[patternId] || gasImpacts.default;
            }

            getSeverityWeight(severity) {
                const weights = { critical: 5, high: 4, medium: 3, low: 2, info: 1 };
                return weights[severity] || 0;
            }

            showLoading() {
                const btn = document.getElementById('analyzeBtn');
                const btnText = document.getElementById('btnText');
                const results = document.getElementById('results');

                btn.disabled = true;
                btnText.innerHTML = 'üîÑ ÿØÿ± ÿ≠ÿßŸÑ ÿ™ÿ≠ŸÑ€åŸÑ...';
                
                results.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>ÿ™ÿ≠ŸÑ€åŸÑ ÿπŸÖŸÇ€å ⁄©ÿØ ÿØÿ± ÿ≠ÿßŸÑ ÿßŸÜÿ¨ÿßŸÖ...</p>
                    </div>
                `;
            }

            showError(message) {
                const results = document.getElementById('results');
                results.innerHTML = `
                    <div class="no-results">
                        ‚ö†Ô∏è ${message}
                    </div>
                `;
            }

            showQuickHints() {
                const code = document.getElementById('solidityCode').value;
                if (code.length < 50) return;

                // Quick vulnerability detection for live feedback
                let hints = [];
                
                if (/\.call\s*\{/.test(code) && !/nonReentrant/.test(code)) {
                    hints.push('‚ö†Ô∏è ÿßÿ≠ÿ™ŸÖÿßŸÑ ÿ¢ÿ≥€åÿ®‚ÄåŸæÿ∞€åÿ±€å Reentrancy');
                }
                
                if (/tx\.origin/.test(code)) {
                    hints.push('üö® ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ tx.origin ÿÆÿ∑ÿ±ŸÜÿß⁄© ÿßÿ≥ÿ™');
                }

                // Show hints in a subtle way (could be expanded)
                console.log('Quick hints:', hints);
            }

            displayResults(vulnerabilities) {
                const btn = document.getElementById('analyzeBtn');
                const btnText = document.getElementById('btnText');
                const results = document.getElementById('results');

                btn.disabled = false;
                btnText.innerHTML = 'üîç ÿ™ÿ≠ŸÑ€åŸÑ ÿßŸÖŸÜ€åÿ™€å';

                if (vulnerabilities.length === 0) {
                    results.innerHTML = `
                        <div class="no-results success">
                            <div style="font-size: 3rem; margin-bottom: 20px;">‚úÖ</div>
                            <h3>Ÿá€å⁄Ü ÿ¢ÿ≥€åÿ®‚ÄåŸæÿ∞€åÿ±€å ÿßŸÖŸÜ€åÿ™€å €åÿßŸÅÿ™ ŸÜÿ¥ÿØ!</h3>
                            <p>⁄©ÿØ ÿ¥ŸÖÿß ÿßÿ≤ ŸÜÿ∏ÿ± ÿßŸÖŸÜ€åÿ™€å ŸÖŸÜÿßÿ≥ÿ® ÿßÿ≥ÿ™.</p>
                        </div>
                    `;
                    return;
                }

                const stats = this.calculateStatistics(vulnerabilities);
                let html = this.generateStatsHTML(stats);
                
                vulnerabilities.forEach((vuln, index) => {
                    html += this.generateVulnerabilityHTML(vuln, index);
                });

                results.innerHTML = html;
                this.attachToggleListeners();
            }

            calculateStatistics(vulnerabilities) {
                return {
                    total: vulnerabilities.length,
                    critical: vulnerabilities.filter(v => v.severity === 'critical').length,
                    high: vulnerabilities.filter(v => v.severity === 'high').length,
                    medium: vulnerabilities.filter(v => v.severity === 'medium').length,
                    low: vulnerabilities.filter(v => v.severity === 'low').length,
                    info: vulnerabilities.filter(v => v.severity === 'info').length
                };
            }

            generateStatsHTML(stats) {
                return `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${stats.total}</div>
                            <div class="stat-label">⁄©ŸÑ ŸÖÿ≥ÿßÿ¶ŸÑ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--danger);">${stats.critical}</div>
                            <div class="stat-label">ÿ®ÿ≠ÿ±ÿßŸÜ€å</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: #ea580c;">${stats.high}</div>
                            <div class="stat-label">ÿ®ÿßŸÑÿß</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--warning);">${stats.medium}</div>
                            <div class="stat-label">ŸÖÿ™Ÿàÿ≥ÿ∑</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--success);">${stats.low + stats.info}</div>
                            <div class="stat-label">Ÿæÿß€å€åŸÜ</div>
                        </div>
                    </div>
                `;
            }

            generateVulnerabilityHTML(vuln, index) {
                const recommendations = this.getRecommendations(vuln.id);
                const codeExample = this.getSecureCodeExample(vuln.id);
                
                return `
                    <div class="vulnerability-card severity-${vuln.severity}">
                        <div class="vulnerability-header" onclick="toggleVulnerability(${index})">
                            <div>
                                <div class="vulnerability-title">${vuln.title}</div>
                                <div class="vulnerability-meta">
                                    ${vuln.findings.length} ŸÖŸàÿ±ÿØ €åÿßŸÅÿ™ ÿ¥ÿØ
                                    ${vuln.lineNumbers.length > 0 ? `‚Ä¢ ÿÆÿ∑Ÿàÿ∑: ${vuln.lineNumbers.slice(0, 5).join(', ')}` : ''}
                                    ${vuln.confidence ? `‚Ä¢ ÿßÿπÿ™ŸÖÿßÿØ: ${vuln.confidence}%` : ''}
                                </div>
                            </div>
                            <div>
                                <span class="severity-badge severity-${vuln.severity}">${this.getSeverityLabel(vuln.severity)}</span>
                                <span class="expand-icon" id="icon-${index}">‚ñº</span>
                            </div>
                        </div>
                        <div class="vulnerability-details" id="details-${index}">
                            <p><strong>ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™:</strong> ${vuln.description}</p>
                            
                            <h4>üéØ ⁄©ÿØŸáÿß€å ŸÖÿ¥⁄©ŸÑ‚ÄåÿØÿßÿ±:</h4>
                            ${vuln.findings.slice(0, 3).map(finding => 
                                `<div class="code-block">${this.escapeHtml(finding.code)}</div>`
                            ).join('')}
                            
                            ${vuln.gasImpact ? `
                                <p><strong>ÿ™ÿ£ÿ´€åÿ± ÿ®ÿ± ⁄Øÿßÿ≤:</strong> <span class="severity-badge severity-${vuln.gasImpact}">${vuln.gasImpact}</span></p>
                            ` : ''}
                            
                            ${recommendations ? `
                                <div class="recommendation">
                                    <h4>üí° ÿ±ÿßŸá‚Äåÿ≠ŸÑ Ÿæ€åÿ¥ŸÜŸáÿßÿØ€å:</h4>
                                    <p>${recommendations}</p>
                                </div>
                            ` : ''}
                            
                            ${codeExample ? `
                                <h4>‚úÖ ŸÖÿ´ÿßŸÑ ⁄©ÿØ ÿßŸÖŸÜ:</h4>
                                <div class="code-block">${codeExample}</div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            getSeverityLabel(severity) {
                const labels = {
                    critical: 'ÿ®ÿ≠ÿ±ÿßŸÜ€å',
                    high: 'ÿ®ÿßŸÑÿß',
                    medium: 'ŸÖÿ™Ÿàÿ≥ÿ∑',
                    low: 'Ÿæÿß€å€åŸÜ',
                    info: 'ÿßÿ∑ŸÑÿßÿπ'
                };
                return labels[severity] || severity;
            }

            getRecommendations(vulnId) {
                const recommendations = {
                    reentrancy: 'ÿßÿ≤ ÿßŸÑ⁄ØŸà€å Checks-Effects-Interactions ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ. ÿßÿ®ÿ™ÿØÿß Ÿàÿ∂ÿπ€åÿ™ ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØÿå ÿ≥Ÿæÿ≥ ÿ™ÿ∫€å€åÿ±ÿßÿ™ ÿ±ÿß ÿßÿπŸÖÿßŸÑ ⁄©ŸÜ€åÿØÿå Ÿà ÿØÿ± ŸÜŸáÿß€åÿ™ ÿ®ÿß ŸÇÿ±ÿßÿ±ÿØÿßÿØŸáÿß€å ÿÆÿßÿ±ÿ¨€å ÿ™ÿπÿßŸÖŸÑ ⁄©ŸÜ€åÿØ. ŸáŸÖ⁄ÜŸÜ€åŸÜ ÿßÿ≤ OpenZeppelin ReentrancyGuard ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.',
                    
                    uncheckedTransfer: 'ŸáŸÖ€åÿ¥Ÿá ŸÜÿ™€åÿ¨Ÿá ŸÅÿ±ÿßÿÆŸàÿßŸÜ€å‚ÄåŸáÿß€å .call() Ÿà .send() ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ. ÿßÿ≤ require() ÿ®ÿ±ÿß€å ÿßÿ∑ŸÖ€åŸÜÿßŸÜ ÿßÿ≤ ŸÖŸàŸÅŸÇ€åÿ™ ÿ™ÿ±ÿß⁄©ŸÜÿ¥ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ €åÿß ÿßÿ≤ ÿßŸÑ⁄ØŸà€å withdrawal ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.',
                    
                    accessControl: 'ÿßÿ≤ modifier Ÿáÿß€å ⁄©ŸÜÿ™ÿ±ŸÑ ÿØÿ≥ÿ™ÿ±ÿ≥€å ŸÖÿßŸÜŸÜÿØ onlyOwner ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ. OpenZeppelin AccessControl €åÿß Ownable ÿ±ÿß ÿ®Ÿá ⁄©ÿßÿ± ÿ®⁄Ø€åÿ±€åÿØ. Ÿáÿ±⁄Øÿ≤ ÿ™Ÿàÿßÿ®ÿπ ÿ≠ÿ≥ÿßÿ≥ ÿ±ÿß ÿ®ÿØŸàŸÜ ⁄©ŸÜÿ™ÿ±ŸÑ ÿØÿ≥ÿ™ÿ±ÿ≥€å public ŸÜ⁄Øÿ∞ÿßÿ±€åÿØ.',
                    
                    integerOverflow: 'ÿß⁄Øÿ± ÿßÿ≤ Solidity 0.8.0+ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äå⁄©ŸÜ€åÿØÿå ÿ®ÿ±ÿ±ÿ≥€å‚ÄåŸáÿß€å overflow ÿÆŸàÿØ⁄©ÿßÿ± ŸÅÿπÿßŸÑ Ÿáÿ≥ÿ™ŸÜÿØ. ÿ®ÿ±ÿß€å ŸÜÿ≥ÿÆŸá‚ÄåŸáÿß€å ŸÇÿØ€åŸÖ€å‚Äåÿ™ÿ± ÿßÿ≤ OpenZeppelin SafeMath ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.',
                    
                    timestampManipulation: 'ÿßÿ≤ block.timestamp ÿ®ÿ±ÿß€å ÿπŸÖŸÑ€åÿßÿ™ ÿ≤ŸÖÿßŸÜ‚Äåÿ®ŸÜÿØ€å ÿØŸÇ€åŸÇ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÜ⁄©ŸÜ€åÿØ. ÿßÿ≤ Oracle Ÿáÿß€å ÿÆÿßÿ±ÿ¨€å ÿ®ÿ±ÿß€å ÿØÿßÿØŸá‚ÄåŸáÿß€å ÿ≤ŸÖÿßŸÜ€å ÿ≠ÿ≥ÿßÿ≥ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ €åÿß toleranceÿß€å ÿ®ÿ±ÿß€å ÿ™ÿ∫€å€åÿ±ÿßÿ™ ÿ≤ŸÖÿßŸÜ€å ÿØÿ± ŸÜÿ∏ÿ± ÿ®⁄Ø€åÿ±€åÿØ.',
                    
                    txOrigin: 'Ÿáÿ±⁄Øÿ≤ ÿßÿ≤ tx.origin ÿ®ÿ±ÿß€å ⁄©ŸÜÿ™ÿ±ŸÑ ÿØÿ≥ÿ™ÿ±ÿ≥€å ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÜ⁄©ŸÜ€åÿØ. ŸáŸÖ€åÿ¥Ÿá ÿßÿ≤ msg.sender ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ ÿ™ÿß ÿßÿ≤ ÿ≠ŸÖŸÑÿßÿ™ phishing ÿ¨ŸÑŸà⁄Ø€åÿ±€å ÿ¥ŸàÿØ.',
                    
                    weakRandomness: 'ÿßÿ≤ Oracle Ÿáÿß€å ÿ™ÿµÿßÿØŸÅ ÿÆÿßÿ±ÿ¨€å ŸÖÿßŸÜŸÜÿØ Chainlink VRF ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ. Ÿáÿ±⁄Øÿ≤ ÿßÿ≤ block.timestampÿå block.difficulty €åÿß block.number ÿ®ÿ±ÿß€å ÿ™ŸàŸÑ€åÿØ ÿπÿØÿØ ÿ™ÿµÿßÿØŸÅ€å ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÜ⁄©ŸÜ€åÿØ.',
                    
                    delegateCall: 'ÿ®ÿ≥€åÿßÿ± ŸÖÿ≠ÿ™ÿßÿ∑ ÿ®ÿßÿ¥€åÿØ. delegatecall ÿ™ŸÜŸáÿß ÿßÿ≤ ÿ¢ÿØÿ±ÿ≥‚ÄåŸáÿß€å ŸÖŸàÿ±ÿØ ÿßÿπÿ™ŸÖÿßÿØ ŸÅÿ±ÿßÿÆŸàÿßŸÜ€å ÿ¥ŸàÿØ. ŸáŸÖ€åÿ¥Ÿá ŸÜÿ™€åÿ¨Ÿá ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ Ÿà ⁄©ŸÜÿ™ÿ±ŸÑ ÿØÿ≥ÿ™ÿ±ÿ≥€å ŸÖŸÜÿßÿ≥ÿ® ÿßÿπŸÖÿßŸÑ ⁄©ŸÜ€åÿØ.',
                    
                    gasLimit: 'ÿßÿ≤ ÿ≠ŸÑŸÇŸá‚ÄåŸáÿß€å ŸÜÿßŸÖÿ≠ÿØŸàÿØ ÿ±Ÿà€å ÿ¢ÿ±ÿß€åŸá‚ÄåŸáÿß ÿ¨ŸÑŸà⁄Ø€åÿ±€å ⁄©ŸÜ€åÿØ. ŸÖÿ≠ÿØŸàÿØ€åÿ™ ÿ™ÿπÿØÿßÿØ ÿ™⁄©ÿ±ÿßÿ± ŸÇÿ±ÿßÿ± ÿØŸá€åÿØ €åÿß ÿßÿ≤ ÿßŸÑ⁄ØŸà€å pagination ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.',
                    
                    frontRunning: 'ÿßÿ≤ ÿßŸÑ⁄ØŸà€å commit-reveal ÿ®ÿ±ÿß€å ÿπŸÖŸÑ€åÿßÿ™ ÿ≠ÿ≥ÿßÿ≥ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ. ÿ™ÿ±ÿß⁄©ŸÜÿ¥‚ÄåŸáÿß€å ŸÖŸáŸÖ ÿ±ÿß private pool ÿßÿ±ÿ≥ÿßŸÑ ⁄©ŸÜ€åÿØ €åÿß ÿßÿ≤ timelock ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.'
                };
                
                return recommendations[vulnId] || '⁄©ÿØ ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ÿ±ÿØŸá Ÿà ÿßÿ≤ best practice Ÿáÿß€å ÿßŸÖŸÜ€åÿ™€å ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.';
            }

            getSecureCodeExample(vulnId) {
                const examples = {
                    reentrancy: `// ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ReentrancyGuard
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";

function withdraw() external nonReentrant {
    uint256 amount = balances[msg.sender];
    require(amount > 0, "No funds");
    balances[msg.sender] = 0; // Effect
    payable(msg.sender).transfer(amount); // Interaction
}`,
                    
                    uncheckedTransfer: `// ÿ®ÿ±ÿ±ÿ≥€å ŸÜÿ™€åÿ¨Ÿá call
(bool success, ) = payable(recipient).call{value: amount}("");
require(success, "Transfer failed");

// €åÿß ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ withdrawal pattern
function withdraw() external {
    uint256 amount = pendingWithdrawals[msg.sender];
    pendingWithdrawals[msg.sender] = 0;
    payable(msg.sender).transfer(amount);
}`,
                    
                    accessControl: `// ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ modifier
modifier onlyOwner() {
    require(msg.sender == owner, "Not owner");
    _;
}

function criticalFunction() external onlyOwner {
    // ÿ™ŸÜŸáÿß ŸÖÿßŸÑ⁄© ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿß€åŸÜ ÿ™ÿßÿ®ÿπ ÿ±ÿß ŸÅÿ±ÿßÿÆŸàÿßŸÜ€å ⁄©ŸÜÿØ
}`,
                    
                    txOrigin: `// ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿµÿ≠€åÿ≠ ÿßÿ≤ msg.sender
require(msg.sender == owner, "Unauthorized");
// ÿ®Ÿá ÿ¨ÿß€å tx.origin == owner`
                };
                
                return examples[vulnId] || null;
            }

            attachToggleListeners() {
                // Event listeners are attached via onclick in HTML
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Global functions for HTML onclick events
        function toggleVulnerability(index) {
            const details = document.getElementById(`details-${index}`);
            const icon = document.getElementById(`icon-${index}`);
            
            if (details.classList.contains('active')) {
                details.classList.remove('active');
                icon.classList.remove('rotated');
            } else {
                details.classList.add('active');
                icon.classList.add('rotated');
            }
        }

        // Initialize the analyzer
        document.addEventListener('DOMContentLoaded', () => {
            new AdvancedSolidityAnalyzer();
        });
    </script>
</body>
</html>
